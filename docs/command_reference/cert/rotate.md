# Cert Rotate

### Description

There is sometimes a need to renew existing certificates on a target, the [gNOI Cert Rotate RPC](https://github.com/openconfig/gnoi/blob/master/cert/cert.proto#L93) does exactly that.

Currently `gNOIc` relies on the target to generate the CSR.

The `rotate` command acts as the client side of the `gNOI Cert Rotate RPC` and effectively renews a previously installed certificate in 5 steps:

- Start a bi-directional gRPC stream.
- Request a CSR from the target.
- Sign the Certificate using the provided CA.
- Send the certificate to the target.
- Finalize the procedure with a [FinalizeRequest](https://github.com/openconfig/gnoi/blob/master/cert/cert.proto#L332)

### Usage

`gnoic [global-flags] cert rotate [local-flags]`

### Flags

#### cert-type

The `--cert-type` flag sets the desired certificate type.

defaults to `CT_X509`

#### city

The `--city` sets the `City` part of the certificate DN (Distinguished Name)

#### common-name

The `--common-name` sets the `CommonName` part of the certificate DN (Distinguished Name)

#### country

The `--country` sets the `Country` part of the certificate DN (Distinguished Name)

#### email-id

The `--email-id` sets the `EmailID` part of the certificate DN (Distinguished Name)

#### ip-address

The `--ip-address` sets an IP address to be added to the certificate as a SAN.

#### id

The `--id` flag sets the desired certificate ID.

#### key-type

The `--key-type` flag sets the desired key type, defaults to `KT_RSA`

#### min-key-size

The `--min-key-size` flag sets the minimum desired key size, defaults to `1024`

#### org

The `--org` sets the `OrganizationName` part of the certificate DN (Distinguished Name)

#### print-csr

The `--print-csr` if set, `gNOIc` prints the CSR generated by the Target.

#### org-unit

The `--org-unit` sets the `OrganizationalUnit` part of the certificate DN (Distinguished Name)

#### state

The `--state` sets the `State` part of the certificate DN (Distinguished Name)

#### validity

The `--validity` sets the validity duration of the certificate, the expected format is Golang's duration format: 1s, 10m, 1h, 87600h.

defaults to `87600h` (10 years)

### Examples

```bash
gnoic -a 172.17.0.100:57400 -u admin -p admin --insecure \
      cert \
      --ca-cert cert.pem --ca-key key.pem \
      rotate --id cert2 \
      --common-name router1 \
      --org OrgInc --org-unit OrgUnit
```

```bash
INFO[0000] read local CA certs                          
INFO[0000] "172.17.0.100:57400" signing certificate "CN=router1,OU=OrgUnit,O=OrgInc" with the provided CA 
INFO[0000] "172.17.0.100:57400" rotating certificate id=cert2 "CN=router1,OU=OrgUnit,O=OrgInc" 
INFO[0000] "172.17.0.100:57400" Rotate RPC successful   
```
